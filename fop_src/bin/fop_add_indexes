#!/usr/bin/env php
<?php
/**
 * Test de lancement d'un outils ajouté.
 * Au lieu de le lancer dans un terminal via `composer run lescript` on le lance via un bin déclaré.
 * Avantage : pas besoin d'inserer les scripts dans le composer cible (dans le projet random existant).
 *
 * Lancement soit par Process , en externe
 * soit par lancement de la commande symfony, en interne.
 *
 * @author Sébastien Monterisi <contact@seb7.fr>
 */

use PrestaShop\AutoIndex\Command\AddAutoIndexCommand;
use Symfony\Component\Console\Application;

function includeIfExists($file)
{
    if (file_exists($file)) {
        return include $file;
    }
}

if (!includeIfExists(__DIR__.'/../../vendor/autoload.php') && !includeIfExists(__DIR__.'/../../../../autoload.php')) {
    $msg = 'no autoload found';
    fwrite(STDERR, $msg);
    exit(1);
}

$application = new Application();
$command = new AddAutoIndexCommand();

$application->add($command);
$application->setDefaultCommand($command->getName());
$application->run(new \Symfony\Component\Console\Input\ArrayInput(['command'=>'prestashop:add:index', '--exclude'=>'vendor' ]));
throw new Exception("Tester si travaille au bon endroit ? Peut fonctionne en create project et en dependance ?");
